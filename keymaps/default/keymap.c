#include QMK_KEYBOARD_H
#include <stdio.h>

enum layer_names{
  _QWERTY,
  _NUMBERS,
  _FUNC
};

const uint16_t PROGMEM keymaps[][MATRIX_ROWS][MATRIX_COLS] = {

 /* Layer 0: Base keys
 *
 * ,-----.-----.-----.-----.-----.                      ,-----.-----.-----.-----.-----.
 * | Q   | W   | E   | R   | T   |                      | Y   | U   | I   | O   | P   |
 * |-----+-----+-----+-----+-----|                      |-----+-----+-----+-----+-----|
 * | A   | S   | D   | F   | G   |                      | H   | J   | K   | L   | ; : | 
 * |-----+-----+-----+-----+-----+                      |-----+-----+-----+-----+-----|
 * |SHF/Z| X   | C   | V   | B   |                      | N   | M   | < , | > . |SHF/?|
 * `-----'-----'-----'-----'-----'                      `-----'-----'-----'-----'-----'
 *               .-------.-------.-------.      .-------.-------.-------.   
 *               |OPT/ESC|  CMD  |CTR/TAB|      | ENTER |L1/SPC |L2/BSP |
 *               '-------'-------'-------'      '-------'-------'-------' 
 */
 
  [0] = LAYOUT_split_3x5_3(
    KC_Q, KC_W, KC_E, KC_R, KC_T,                                     KC_Y, KC_U, KC_I, KC_O, KC_P, 
    KC_A, KC_S, KC_D, KC_F, KC_G,                                     KC_H, KC_J, KC_K, KC_L, KC_SCLN, 
    LSFT_T(KC_Z), KC_X, KC_C, KC_V, KC_B,                             KC_N, KC_M, KC_COMM, KC_DOT, RSFT_T(KC_SLSH), 
                      LALT_T(KC_ESC), KC_LGUI, LCTL_T(KC_TAB),      KC_ENT, LT(1,KC_SPC), LT(2,KC_BSPC)
  ),

 /* Layer 1: Symbols
 * ,-----.-----.-----.-----.-----.                      ,-----.-----.-----.-----.-----.
 * | 1!  | 2@  | 3#  | 4$  | 5%  |                      | 6^  | 7&  | 8*  | 9(  | 0)  |
 * |-----+-----+-----+-----+-----|                      |-----+-----+-----+-----+-----|
 * | `~  |HOME |PGUP |PGDN | END |                      |LEFT |DOWN | UP  |RGHT | ' " |
 * |-----+-----+-----+-----+-----+                      |-----+-----+-----+-----+-----|
 * |SHFT |     |     |     |     |                      | -_  | =+  | [{  | ]}  |SHF\||
 * `-----'-----'-----'-----'-----'                      `-----'-----'-----'-----'-----'
 *               .-------.-------.-------.      .-------.-------.-------.   
 *               |       |       |       |      |       |(hold) |       |
 *               '-------'-------'-------'      '-------'-------'-------' 
 */

  [1] = LAYOUT_split_3x5_3(
    KC_1, KC_2, KC_3, KC_4, KC_5,                          KC_6, KC_7, KC_8, KC_9, KC_0, 
    KC_GRV, KC_HOME, KC_PGUP, KC_PGDN, KC_END,             KC_LEFT, KC_DOWN, KC_UP, KC_RGHT, KC_QUOT, 
    KC_LSFT, KC_DEL, KC_NO, KC_NO, KC_NO,                  KC_MINS, KC_EQL, KC_LBRC, KC_RBRC, RSFT_T(KC_BSLS), 
                      KC_NO, KC_NO, KC_NO,          KC_NO, KC_TRNS, KC_NO
  ),

  /* Layer 2: Function keys
* ,-----.-----.-----.-----.-----.                      ,-----.-----.-----.-----.-----.
* | F1  | F2  | F3  | F4  | F5  |                      | F6  | F7  | F8  | F9  | F10 |
* |-----+-----+-----+-----+-----|                      |-----+-----+-----+-----+-----|
* | F11 | F12 |PREV |PLAY |NEXT |                      |MUTE |Vol- |Vol+ | Br- | Br+ |
* |-----+-----+-----+-----+-----+                      |-----+-----+-----+-----+-----|
* |     |     |     |     |     |                      |     |     |     |     |     |
* `-----'-----'-----'-----'-----'                      `-----'-----'-----'-----'-----'
*               .-------.-------.-------.      .-------.-------.-------.   
*               |       |       |       |      |       |       |(hold) |
*               '-----------------------'      '-------'-------'-------' 
*/

  [2] = LAYOUT_split_3x5_3(
    KC_F1, KC_F2, KC_F3, KC_F4, KC_F5,                            KC_F6, KC_F7, KC_F8, KC_F9, KC_F10, 
    KC_F11, KC_F12, KC_MPRV, KC_MPLY, KC_MNXT,                    KC_MUTE, KC_VOLD, KC_VOLU, KC_BRID, KC_BRIU, 
    KC_NO, KC_NO, KC_NO, KC_NO, KC_NO,                            KC_NO, KC_NO, KC_NO, KC_NO, KC_NO, 
                            KC_NO, KC_NO, KC_NO,           KC_NO, KC_NO, KC_TRNS
  )
};

// #ifdef ENCODER_MAP_ENABLE
// const uint16_t PROGMEM encoder_map[][NUM_ENCODERS][2] = {
//   [0] = { ENCODER_CCW_CW(KC_VOLD, KC_VOLU) },
// };
// #endif
static uint16_t press_count = 0;

bool process_record_user(uint16_t keycode, keyrecord_t *record) {

     // キーが押されたら、カウンターをインクリメントする
    if (record->event.pressed) {
        press_count++;
    }
    return true;
}

// OLED
#ifdef OLED_ENABLE

static void render_logo(void) {
    static const char PROGMEM raw_logo[] = {
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xC0, 0xC0, 0x20, 0x20, 0x10, 0x10, 0x10, 0x08, 
0x04, 0x03, 0x04, 0x08, 0x08, 0x10, 0x20, 0x20, 0xC0, 0xC0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xC0, 0x20, 0x18, 0x04, 0x04, 0x04, 0x04, 
0x18, 0x60, 0x98, 0x04, 0x02, 0x01, 0x01, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x01, 0x01, 0x01, 0x02, 0x02, 
0x02, 0x04, 0x04, 0x04, 0x18, 0x18, 0x18, 0x18, 0x04, 0x04, 0x04, 0x02, 0x02, 0xFE, 0x00, 0x00, 
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x7F, 0x40, 0x40, 0x40, 0x40, 0x80, 0x80, 
0x80, 0x80, 0x81, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x07, 0x07, 0x00, 0x00, 0x00, 0x08, 
0x10, 0x10, 0x08, 0x20, 0x20, 0x20, 0x10, 0x00, 0x00, 0x00, 0xC0, 0xC0, 0xC0, 0x00, 0x80, 0x40, 
0x20, 0x10, 0x10, 0x10, 0x10, 0x20, 0xC0, 0x00, 0x00, 0x00, 0x00, 0x40, 0xB0, 0x0F, 0x00, 0x00, 
0x80, 0x80, 0x40, 0x30, 0x30, 0x08, 0x08, 0x08, 0x08, 0x04, 0x04, 0x04, 0x04, 0x04, 0x05, 0x05, 
0x05, 0x05, 0x05, 0x0A, 0x0A, 0x0A, 0x32, 0x32, 0x34, 0x44, 0x84, 0x04, 0x08, 0x08, 0x08, 0x08, 
0x08, 0x30, 0x30, 0x30, 0x30, 0x30, 0x40, 0x40, 0x40, 0x40, 0x81, 0x81, 0x81, 0x80, 0xFF, 0x00, 
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x06, 0x00, 0x00, 0x00, 0x00, 0x03, 0x0C, 0xF0, 0x00, 
0xFF, 0xFF, 0x44, 0x98, 0x98, 0x20, 0x20, 0x20, 0x20, 0x40, 0x40, 0x40, 0x40, 0x40, 0x40, 0x40, 
0x40, 0x40, 0x40, 0x20, 0x20, 0x20, 0xF8, 0xF8, 0x18, 0x04, 0x07, 0x02, 0x02, 0x02, 0x02, 0x01, 
0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x02, 0x02, 0x02, 0x02, 0x04, 0x04, 0x19, 
0xE1, 0x01, 0x01, 0x01, 0x02, 0x02, 0x02, 0x02, 0x04, 0x04, 0x04, 0x04, 0x04, 0x18, 0x18, 0x00, 
0x0F, 0x0F, 0xF0, 0x00, 0x00, 0x03, 0x03, 0x03, 0x03, 0x04, 0x04, 0x04, 0x04, 0x04, 0x04, 0x04, 
0x04, 0x04, 0x04, 0x03, 0x03, 0x03, 0xFF, 0xFF, 0x13, 0x24, 0x24, 0xC8, 0xC8, 0xC8, 0xC8, 0x10, 
0x10, 0x10, 0x10, 0x10, 0x10, 0x10, 0x10, 0x10, 0x10, 0xC8, 0xC8, 0xC8, 0xC8, 0x24, 0x24, 0x13, 
0xFF, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
0x00, 0x00, 0x01, 0x3E, 0x44, 0x88, 0x88, 0x88, 0x88, 0x30, 0x30, 0x30, 0x30, 0x30, 0x30, 0x30, 
0x30, 0x30, 0x30, 0x88, 0x88, 0x88, 0x47, 0x47, 0x7C, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 
0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0x7C, 
0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 
0x01, 0x01, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0F, 0x11, 0x26, 0x26, 0x26, 0x26, 0x48, 
0x48, 0x48, 0x48, 0x48, 0x48, 0x48, 0x48, 0x48, 0x48, 0x26, 0x26, 0x26, 0x26, 0x11, 0x0F, 0x00, 
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
    };
    oled_write_raw_P(raw_logo, sizeof(raw_logo));
}

// Rotate OLED
oled_rotation_t oled_init_user(oled_rotation_t rotation) {
    return OLED_ROTATION_270; 
}

// Draw to OLED
bool oled_task_user() {
    // oled_write_ln_P(PSTR(QMK_KEYBOARD), false);
    // oled_write_ln_P(PSTR(" "), false);

    render_logo();

    oled_set_cursor(0, 9);
    
    oled_write_ln_P(PSTR(""), false);

    oled_write_P(PSTR("LAYER: "), false);
    
    oled_write_ln_P(PSTR(" "), false);
    oled_write_ln_P(PSTR(" "), false);
    
     // Switch on current active layer
    switch (get_highest_layer(layer_state)) {
        case _QWERTY:
            oled_write_P(PSTR("QWERTY\n"), false);
            break;
        case _NUMBERS:
            oled_write_P(PSTR("NUMBER\n"), false);
            break;
        case _FUNC: 
            oled_write_P(PSTR("FUNCTION\n"), false);
            break;
    }
    oled_write_ln_P(PSTR(" "), false);
    char count_str[24];
    snprintf(count_str, sizeof(count_str), "%d", press_count);
    oled_write_ln(count_str, false);
    
    return false;
}
#endif